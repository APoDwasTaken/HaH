<!DOCTYPE html>
<html>
	<head>
		<script src='three.min.js'></script>
		<script src='ColladaLoader.js'></script>
		<script src='http://sdk.altvr.com/libs/altspace.js/0.12.0/altspace.min.js'></script>
		<script src='behaviors.js'></script>
		<script src='confetti.js'></script>
	</head>
	<body>
		<script>

			if(altspace.inClient){
				var renderer = altspace.getThreeJSRenderer();
			}
			else {
				renderer = new THREE.WebGLRenderer();
				renderer.setSize(1280, 720);
				renderer.setClearColor( 0x888888 );
				document.body.appendChild(renderer.domElement);
			}

			var scene = new THREE.Scene();

			var camera = new THREE.PerspectiveCamera(45, 1280/720, 1, 10);
			camera.position.set(0, -1, -5);
			camera.lookAt(new THREE.Vector3(0,-1,0));
			scene.add(camera);
			
			window.Models = {};
			var loader = new THREE.ColladaLoader();
			loader.load('models/confettiball.dae', function(results)
			{
				var ball = window.Models.confettiBall = results.scene.children[0];

				var loader = new THREE.TextureLoader();
				loader.load('models/leftao.png', function(tex){
					ball.getObjectByName('left').children[0].material = new THREE.MeshBasicMaterial({
						map: tex, side: THREE.DoubleSide
					});
				});
				loader.load('models/rightao.png', function(tex){
					ball.getObjectByName('right').children[0].material = new THREE.MeshBasicMaterial({
						map: tex, side: THREE.DoubleSide
					});
					kaboom();
				});

			});

			var confetti = null;

			function kaboom()
			{
				confetti = new Utils.Confetti();
				confetti.rotation.set(-Math.PI/2,0,0);
				scene.add(confetti);
				setTimeout(kaboom, 3500);
			}
			
			var lastT = Date.now();
			window.requestAnimationFrame(function animate(timestamp)
			{
				window.requestAnimationFrame(animate);
				
				var nowT = Date.now();
				//if(confetti) confetti.updateParticles(nowT-lastT);
				scene.updateAllBehaviors(nowT-lastT);
				lastT = nowT;

				renderer.render(scene, camera);
			});

		</script>
	</body>
</html>
